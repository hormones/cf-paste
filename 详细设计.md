# é¡¹ç›®é‡æ„è¯¦ç»†è®¾è®¡ï¼ˆè½»é‡åŒ–æ–¹æ¡ˆï¼‰

## ğŸ“‹ è®¾è®¡æ¦‚è¿°

æœ¬é‡æ„**åªè§£å†³æ ¸å¿ƒé—®é¢˜**ï¼Œé¿å…è¿‡åº¦è®¾è®¡ï¼š
1. **å¸¸é‡é‡å¤**ï¼šæ ¹ç›®å½•å…±äº«constants.ts
2. **ä¸Šä¼ é‡å¤ä»£ç **ï¼šä¸¤ä¸ªå‡½æ•°ç»Ÿä¸€ä¸Šä¼ é€»è¾‘  
3. **ç»„ä»¶èŒè´£è¿‡é‡**ï¼šè½»é‡çº§æ‹†åˆ†DefaultTemplate.vue

**åŸåˆ™ï¼šè½»é‡ + ç®€æ´ + ä¼˜é›…ï¼Œå¿…è¦æ—¶æ”¾å¼ƒè®¾è®¡**

---

## ğŸ—ï¸ ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ä¼˜åŒ–

### 1. ğŸ”„ å…±äº«å¸¸é‡ï¼ˆä¿æŒç®€å•ï¼‰

#### å®æ–½æ–¹æ¡ˆ
```typescript
// constants.ts (é¡¹ç›®æ ¹ç›®å½•)
export const EXPIRY_OPTIONS = [
  { label: '1å°æ—¶', value: 60 * 60 },
  { label: '1å¤©', value: 24 * 60 * 60 },
  { label: '3å¤©', value: 3 * 24 * 60 * 60 },
  { label: '1å‘¨', value: 7 * 24 * 60 * 60 },
  { label: '1ä¸ªæœˆ', value: 30 * 24 * 60 * 60 },
  { label: '3ä¸ªæœˆ', value: 90 * 24 * 60 * 60 },
] as const

export const STORAGE_CONSTANTS = {
  PASTE_FILE: 'index.txt',
  FILE_FOLDER: 'files',
  TEMPLATE_FOLDER: 'templates',
} as const

export const RESERVED_WORDS = [
  'index', 'main', 'config', 'utils', 'views', 'public',
  'pages', 'admin', 'template', 'templates', 'file', 'files',
] as const

// å‘åå…¼å®¹çš„ç»Ÿä¸€å¯¼å‡º
export const Constant = {
  WORD: 'word',
  AUTH: 'auth',
  PASSWORD_DISPLAY: '******',
  ...STORAGE_CONSTANTS,
  REVERSED_WORDS: RESERVED_WORDS,
  EXPIRY_OPTIONS,
  MESSAGES: {
    NO_CONTENT: 'è¯·è¾“å…¥å†…å®¹æˆ–ä¸Šä¼ æ–‡ä»¶',
    SAVE_SUCCESS: 'ä¿å­˜æˆåŠŸ',
    UPLOAD_SUCCESS: 'ä¸Šä¼ æˆåŠŸ',
    // å…¶ä»–æ¶ˆæ¯...
  }
} as const
```

```typescript
// src/constant/index.ts 
export { Constant, EXPIRY_OPTIONS } from '../../constants'

// server/constant/index.ts
export { Constant, EXPIRY_OPTIONS } from '../../constants'
// åç«¯éªŒè¯: const allowedValues = EXPIRY_OPTIONS.map(opt => opt.value)
```

### 2. è½»é‡é”™è¯¯å¤„ç†

```typescript
// src/utils/errorHandler.ts - ä¸€ä¸ªå‡½æ•°æå®š
export function handleError(error: any): string {
  if (!error.response) return 'ç½‘ç»œè¿æ¥å¤±è´¥'
  
  const status = error.response.status
  if (status === 401 || status === 403) return 'è®¿é—®è¢«æ‹’ç»'
  if (status === 413) return 'æ–‡ä»¶å¤ªå¤§'
  if (error.name === 'AbortError') return 'æ“ä½œå·²å–æ¶ˆ'
  
  return error.response?.data?.msg || error.message || 'æ“ä½œå¤±è´¥'
}
```

---

## ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒä¼˜åŒ–  

### 3. ğŸ”´ ä¸Šä¼ æ¶æ„æç®€åŒ–

#### åˆ é™¤çš„å¤æ‚è®¾è®¡
- âŒ FileUploaderç±» (100+è¡Œ)
- âŒ ProgressTrackerç±» (80+è¡Œ) 
- âŒ å¤æ‚çš„å›è°ƒæ¥å£
- âŒ å¹¶å‘æ§åˆ¶é€»è¾‘

#### âœ… æ–°è®¾è®¡ï¼šä¸¤ä¸ªå‡½æ•°è§£å†³ä¸€åˆ‡

```typescript
// src/utils/fileUploader.ts - æç®€è®¾è®¡
let configCache: UploadConfig | null = null

/**
 * ä¸»ä¸Šä¼ å‡½æ•° - è‡ªåŠ¨é€‰æ‹©ç­–ç•¥
 */
export async function uploadFile(
  file: File,
  onProgress?: (percentage: number) => void
): Promise<void> {
  const config = await getConfig()
  
  if (file.size > config.chunkThreshold) {
    return uploadChunked(file, config, onProgress)
  } else {
    return uploadDirect(file, onProgress)
  }
}

/**
 * ç›´ä¼ ä¸Šä¼ 
 */
async function uploadDirect(file: File, onProgress?: (percentage: number) => void) {
  return new Promise<void>((resolve, reject) => {
    const xhr = new XMLHttpRequest()
    
    xhr.upload.onprogress = (e) => {
      if (e.lengthComputable && onProgress) {
        onProgress(Math.round((e.loaded / e.total) * 100))
      }
    }
    
    xhr.onload = () => xhr.status === 200 ? resolve() : reject(new Error(`ä¸Šä¼ å¤±è´¥: ${xhr.status}`))
    xhr.onerror = () => reject(new Error('ç½‘ç»œé”™è¯¯'))
    
    xhr.open('POST', `/api/file/${file.name}`)
    xhr.setRequestHeader('Content-Type', 'application/octet-stream')
    xhr.send(file)
  })
}

/**
 * åˆ†ç‰‡ä¸Šä¼  - é¡ºåºç®€å•
 */
async function uploadChunked(file: File, config: UploadConfig, onProgress?: (percentage: number) => void) {
  // 1. åˆå§‹åŒ–
  const { data: init } = await request.post('/file/multipart/init', {
    filename: file.name,
    fileSize: file.size,
    chunkSize: config.chunkSize
  })
  
  const { uploadId, totalChunks } = init
  const parts: Array<{ partNumber: number; etag: string }> = []
  
  try {
    // 2. é¡ºåºä¸Šä¼ ï¼ˆæ— å¹¶å‘ï¼Œç®€åŒ–ï¼‰
    for (let i = 0; i < totalChunks; i++) {
      const start = i * config.chunkSize
      const end = Math.min(start + config.chunkSize, file.size)
      const chunk = file.slice(start, end)
      
      const { data } = await request.put(`/file/multipart/chunk/${uploadId}`, chunk, {
        params: { partNumber: i + 1, fileKey: file.name }
      })
      
      parts.push({ partNumber: i + 1, etag: data.etag })
      onProgress?.(Math.round(((i + 1) / totalChunks) * 100))
    }
    
    // 3. å®Œæˆ
    await request.post(`/file/multipart/complete/${uploadId}`, {
      fileKey: file.name,
      parts
    })
  } catch (error) {
    // æ¸…ç†
    try {
      await request.delete(`/file/multipart/cancel/${uploadId}`)
    } catch {}
    throw error
  }
}

async function getConfig(): Promise<UploadConfig> {
  if (!configCache) {
    try {
      configCache = await configApi.getUploadConfig()
    } catch {
      configCache = { // é»˜è®¤é…ç½®
        maxFileSize: 300 * 1024 * 1024,
        chunkThreshold: 100 * 1024 * 1024,
        chunkSize: 50 * 1024 * 1024,
        maxFiles: 10,
        maxTotalSize: 300 * 1024 * 1024,
        maxConcurrent: 3
      }
    }
  }
  return configCache
}
```

### 4. APIå±‚è½»é‡ç®€åŒ–

```typescript
// src/api/file.ts - åˆ é™¤é‡å¤æ–¹æ³•ï¼Œä¿ç•™æ ¸å¿ƒ
export const fileApi = {
  // åªä¿ç•™å¿…è¦çš„æ–¹æ³•
  async upload(file: File, onProgress?: (percentage: number) => void) {
    try {
      await uploadFile(file, onProgress)
      return { success: true }
    } catch (error) {
      throw new Error(handleError(error))
    }
  },
  
  async list() {
    return request.get('/file/list')
  },
  
  async delete(filename: string) {
    return request.delete(`/file/${filename}`)
  },
  
  download(filename: string) {
    window.open(`/api/file/download?name=${filename}`)
  }
}
```

### 5. çŠ¶æ€ç®¡ç†è½»é‡åŒ–

```typescript
// src/composables/useUploadConfig.ts - å»æ‰provide/inject
const config = ref<UploadConfig | null>(null)

export function useUploadConfig() {
  const fetchConfig = async () => {
    if (!config.value) {
      config.value = await getConfig()
    }
    return config.value
  }
  
  return { config: readonly(config), fetchConfig }
}
```

---

## ğŸ¨ ç¬¬ä¸‰é˜¶æ®µï¼šç»„ä»¶ä¼˜åŒ–ï¼ˆå……åˆ†æ‹†åˆ† + Elementç»„ä»¶åŒ–ï¼‰

### 6. ç»„ä»¶æ‹†åˆ†æ–¹æ¡ˆ

#### ğŸ¯ æ‹†åˆ†ç›®æ ‡
- **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½åŒºåŸŸ
- **æ ·å¼ä¼˜åŒ–**ï¼šå¤§é‡ä½¿ç”¨Element Plusç»„ä»¶ï¼Œå‡å°‘è‡ªå®šä¹‰CSS
- **æ˜“ç»´æŠ¤**ï¼šé€»è¾‘æ¸…æ™°ï¼Œä¾¿äºåç»­æ‰©å±•

#### ğŸ“¦ ç»„ä»¶æ‹†åˆ†æ¸…å•

```vue
<!-- src/templates/DefaultTemplate.vue - è½»é‡åŒ–ä¸»å®¹å™¨ -->
<template>
  <div class="paste-container">
    <el-row :gutter="20" class="main-layout">
      <el-col :span="viewMode ? 24 : 16">
        <TabsContainer 
          v-model:active-tab="activeTab"
          :view-mode="viewMode"
          @delete="handleDelete"
          @open-settings="handleOpenSettings"
        >
          <template #clipboard>
            <ClipboardPanel 
              v-model="keyword.content"
              :view-mode="viewMode"
              @auto-save="autoSave"
            />
          </template>
          <template #files>
            <FileUploadPanel 
              :can-upload="canUpload"
              :max-files="maxFiles"
              :max-total-size="maxTotalSize"
              :used-space="usedSpace"
              :upload-states="uploadStates"
              :view-mode="viewMode"
              @upload="handleFileUpload"
              @retry="handleRetry"
              @cancel="cancelUpload"
              @dismiss="handleDismissUpload"
            />
            <FileTable
              :file-list="fileList"
              :view-mode="viewMode"
              :used-space="usedSpace"
              @download="handleFileDownload"
              @delete="handleFileDelete"
              @delete-all="handleDeleteAllFiles"
            />
          </template>
        </TabsContainer>
      </el-col>
      
      <el-col :span="8" v-if="!viewMode">
        <el-space direction="vertical" size="large" fill>
          <InfoPanel :keyword="keyword" />
          <QRCodePanel 
            v-if="keyword.id"
            :keyword="keyword"
            :read-only-link="readOnlyLink"
            @copy-link="copyReadOnlyLink"
          />
        </el-space>
      </el-col>
    </el-row>

    <PasswordDialog v-model="showPasswordDialog" @verified="handlePasswordVerified" />
    <SettingsDialog v-model="showSettings" @save="handleSettingsSave" />
  </div>
</template>
```

#### ğŸ§© ç»„ä»¶è¯¦ç»†è®¾è®¡

##### 1. TabsContainer.vue - æ ‡ç­¾å®¹å™¨
```vue
<!-- src/components/TabsContainer.vue -->
<template>
  <el-card class="tabs-card" shadow="never">
    <template #header>
      <div class="tabs-header">
        <el-tabs v-model="activeTab" @tab-change="$emit('update:activeTab', $event)">
          <el-tab-pane label="å‰ªè´´æ¿" name="clipboard" />
          <el-tab-pane :label="fileTabLabel" name="files" />
        </el-tabs>
        
        <el-space v-if="!viewMode">
          <el-button type="danger" text @click="$emit('delete')" :icon="Delete" />
          <el-button type="primary" text @click="$emit('open-settings')" :icon="Setting" />
        </el-space>
      </div>
    </template>
    
    <div class="tab-content">
      <div v-show="activeTab === 'clipboard'" class="tab-pane">
        <slot name="clipboard" />
      </div>
      <div v-show="activeTab === 'files'" class="tab-pane">
        <slot name="files" />
      </div>
    </div>
  </el-card>
</template>
```

##### 2. ClipboardPanel.vue - å‰ªè´´æ¿é¢æ¿
```vue
<!-- src/components/ClipboardPanel.vue -->
<template>
  <el-input
    :model-value="modelValue"
    @update:model-value="$emit('update:modelValue', $event)"
    type="textarea"
    :rows="15"
    placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´å†…å®¹..."
    resize="none"
    @blur="$emit('auto-save')"
    :disabled="viewMode"
  />
</template>
```

##### 3. FileUploadPanel.vue - æ–‡ä»¶ä¸Šä¼ é¢æ¿
```vue
<!-- src/components/FileUploadPanel.vue -->
<template>
  <el-card v-if="uploadStates.size === 0" class="upload-card" shadow="never">
    <el-upload
      :http-request="$emit('upload', $event)"
      :disabled="!canUpload"
      drag
      class="upload-dragger"
    >
      <el-icon class="el-icon--upload"><UploadFilled /></el-icon>
      <div class="el-upload__text">å°†æ–‡ä»¶æ‹–åˆ°æ­¤å¤„ï¼Œæˆ–<em>ç‚¹å‡»ä¸Šä¼ </em></div>
      <template #tip>
        <div class="upload-tip">
          <el-text size="small" type="info">
            æœ€å¤šä¸Šä¼  {{ maxFiles }} ä¸ªæ–‡ä»¶ï¼Œå•æ–‡ä»¶æœ€å¤§ {{ Utils.humanReadableSize(maxTotalSize) }}
          </el-text>
          <el-text v-if="!viewMode" size="small">
            å·²ç”¨ç©ºé—´: {{ Utils.humanReadableSize(usedSpace) }} / {{ Utils.humanReadableSize(maxTotalSize) }}
          </el-text>
        </div>
      </template>
    </el-upload>
  </el-card>
  
  <UploadProgress
    v-else
    :upload-states="uploadStates"
    @retry="$emit('retry', $event)"
    @cancel="$emit('cancel', $event)"
    @dismiss="$emit('dismiss', $event)"
  />
</template>
```

##### 4. FileTable.vue - æ–‡ä»¶è¡¨æ ¼
```vue
<!-- src/components/FileTable.vue -->
<template>
  <div class="file-table-container">
    <el-card v-if="fileList.length > 0 && !viewMode" class="file-actions-card" shadow="never">
      <div class="file-actions">
        <el-text type="info">
          å…± {{ fileList.length }} ä¸ªæ–‡ä»¶ï¼Œ{{ Utils.humanReadableSize(usedSpace) }}
        </el-text>
        <el-button type="danger" size="small" :icon="Delete" @click="$emit('delete-all')" plain>
          å…¨éƒ¨åˆ é™¤
        </el-button>
      </div>
    </el-card>

    <el-table :data="fileList" stripe>
      <el-table-column prop="name" label="æ–‡ä»¶å" min-width="140" show-overflow-tooltip />
      <el-table-column prop="size" label="å¤§å°" min-width="90">
        <template #default="{ row }">
          {{ Utils.humanReadableSize(row.size) }}
        </template>
      </el-table-column>
      <el-table-column prop="uploaded" label="ä¸Šä¼ æ—¶é—´" min-width="120">
        <template #default="{ row }">
          {{ new Date(row.uploaded).toLocaleString() }}
        </template>
      </el-table-column>
      <el-table-column label="æ“ä½œ" fixed="right" align="center" width="120">
        <template #default="{ row }">
          <el-button-group>
            <el-button type="primary" :icon="Download" @click="$emit('download', row.name)" text />
            <el-button v-if="!viewMode" type="danger" :icon="Delete" @click="$emit('delete', row.name)" text />
          </el-button-group>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>
```

##### 5. InfoPanel.vue - ä¿¡æ¯é¢æ¿ï¼ˆElementç»„ä»¶åŒ–ï¼‰
```vue
<!-- src/components/InfoPanel.vue -->
<template>
  <el-card class="info-card" shadow="never">
    <template #header>
      <el-text tag="b">åŸºæœ¬ä¿¡æ¯</el-text>
    </template>
    
    <el-descriptions :column="1" border size="small">
      <el-descriptions-item label="åˆ›å»ºæ—¶é—´">
        {{ formatDate(keyword.create_time) }}
      </el-descriptions-item>
      <el-descriptions-item label="æ›´æ–°æ—¶é—´">
        {{ formatDate(keyword.update_time) }}
      </el-descriptions-item>
      <el-descriptions-item label="ä¸Šæ¬¡æŸ¥çœ‹">
        {{ formatDate(keyword.last_view_time) }}
      </el-descriptions-item>
      <el-descriptions-item label="è¿‡æœŸæ—¶é—´">
        {{ formatDate(keyword.expire_time) }}
      </el-descriptions-item>
      <el-descriptions-item label="æŸ¥çœ‹æ¬¡æ•°">
        {{ !keyword.id ? '-' : (keyword.view_count || 0) + 'æ¬¡' }}
      </el-descriptions-item>
    </el-descriptions>
  </el-card>
</template>
```

##### 6. QRCodePanel.vue - äºŒç»´ç é¢æ¿ï¼ˆElementç»„ä»¶åŒ–ï¼‰
```vue
<!-- src/components/QRCodePanel.vue -->
<template>
  <el-card class="qrcode-card" shadow="never">
    <template #header>
      <el-text tag="b">åªè¯»é“¾æ¥</el-text>
    </template>
    
    <div class="qrcode-container">
      <div class="qrcode-wrapper" @click="$emit('copy-link')">
        <QRCode :data="readOnlyLink" :size="150" />
        <div class="qrcode-overlay">
          <el-text size="small">ç‚¹å‡»å¤åˆ¶åªè¯»é“¾æ¥</el-text>
        </div>
      </div>
      
      <el-divider />
      
      <el-descriptions :column="1" size="small">
        <el-descriptions-item label="å£ä»¤">
          {{ keyword.view_word }}
        </el-descriptions-item>
      </el-descriptions>
    </div>
  </el-card>
</template>
```

### 7. æ ·å¼ä¼˜åŒ–ç­–ç•¥

#### ğŸ¨ Elementç»„ä»¶æ›¿ä»£æ–¹æ¡ˆ
```scss
// å¤§å¹…å‡å°‘è‡ªå®šä¹‰æ ·å¼ï¼Œä½¿ç”¨Elementç»„ä»¶ç‰¹æ€§

// âœ… ä½¿ç”¨ el-card æ›¿ä»£è‡ªå®šä¹‰é¢æ¿
.custom-panel { /* åˆ é™¤ */ }

// âœ… ä½¿ç”¨ el-descriptions æ›¿ä»£è‡ªå®šä¹‰info-item
.info-item { /* åˆ é™¤ */ }

// âœ… ä½¿ç”¨ el-space æ›¿ä»£è‡ªå®šä¹‰é—´è·
.manual-spacing { /* åˆ é™¤ */ }

// âœ… ä½¿ç”¨ el-divider æ›¿ä»£è‡ªå®šä¹‰åˆ†å‰²çº¿
.custom-divider { /* åˆ é™¤ */ }

// âœ… ä½¿ç”¨ el-row/el-col æ›¿ä»£è‡ªå®šä¹‰å¸ƒå±€
.manual-layout { /* åˆ é™¤ */ }

// âœ… ä¿ç•™å¿…è¦çš„ä¸šåŠ¡æ ·å¼
.qrcode-overlay {
  position: absolute;
  /* ä¿ç•™å¿…è¦çš„äº¤äº’æ ·å¼ */
}
```

---

## âœ… ç¬¬å››é˜¶æ®µï¼šéªŒè¯æ”¶å°¾

### 8. å®æ–½æ­¥éª¤

1. **åˆ›å»º** `constants.ts` - 5åˆ†é’Ÿ
2. **æ›´æ–°** å¸¸é‡å¼•ç”¨ - 10åˆ†é’Ÿ  
3. **æ›¿æ¢** `src/utils/chunkUploader.ts` - 15åˆ†é’Ÿ
4. **ç®€åŒ–** `src/api/file.ts` - 10åˆ†é’Ÿ
5. **æµ‹è¯•** ä¸Šä¼ åŠŸèƒ½ - 10åˆ†é’Ÿ
6. **æ‹†åˆ†** SettingsDialog - 10åˆ†é’Ÿï¼ˆå¯é€‰ï¼‰

### 9. æ•ˆæœé¢„ä¼°

- **ä»£ç å‡å°‘**ï¼šåˆ é™¤çº¦400è¡Œå¤æ‚ä»£ç 
- **æ–‡ä»¶å‡å°‘**ï¼šåˆ é™¤chunkUploader.tsç­‰
- **å¤æ‚åº¦é™ä½**ï¼šæ— ç±»ã€æ— å¤æ‚æ¥å£ã€æ— è¿‡åº¦æŠ½è±¡
- **ç»´æŠ¤æ€§æå‡**ï¼šé€»è¾‘æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£å’Œä¿®æ”¹

---

## ğŸ’¡ æœ€ç»ˆæ–¹æ¡ˆæ€»ç»“

### âœ… ä¿ç•™çš„è®¾è®¡
- å…±äº«å¸¸é‡ï¼ˆç®€å•æœ‰æ•ˆï¼‰
- ç»Ÿä¸€ä¸Šä¼ å‡½æ•°ï¼ˆè§£å†³æ ¸å¿ƒé—®é¢˜ï¼‰
- è½»é‡é”™è¯¯å¤„ç†ï¼ˆå®ç”¨ä¸»ä¹‰ï¼‰

### âŒ åˆ é™¤çš„è¿‡åº¦è®¾è®¡  
- å¤æ‚çš„ç±»å’Œæ¥å£ç³»ç»Ÿ
- è¿‡åº¦çš„æŠ½è±¡å’Œå°è£…
- ä¸å¿…è¦çš„ç»„ä»¶æ‹†åˆ†
- å¤æ‚çš„çŠ¶æ€ç®¡ç†

### ğŸ¯ ç¬¦åˆåŸåˆ™
- **è½»é‡**ï¼šæœ€å°‘ä»£ç è§£å†³é—®é¢˜
- **ç®€æ´**ï¼šé€»è¾‘æ¸…æ™°æ˜“æ‡‚
- **ä¼˜é›…**ï¼šå¿…è¦æ—¶æ”¾å¼ƒè®¾è®¡
- **å®ç”¨**ï¼šå¿«é€Ÿå¼€å‘ï¼Œå®¹æ˜“ç»´æŠ¤

**è¿™æ˜¯ä¸€ä¸ªçœŸæ­£è½»é‡åŒ–çš„é‡æ„æ–¹æ¡ˆï¼Œç¬¦åˆé¡¹ç›®çš„ç®€æ´å®šä½ã€‚** 